@if (investment()) {
    <div class="bg-surface-0 dark:bg-surface-900 rounded-2xl overflow-hidden">
        <!-- Image Container -->
        <div class="aspect-square w-full max-h-72 overflow-hidden bg-surface-100 dark:bg-surface-800">
            <img [src]="investment()!.imageUrl" [alt]="investment()!.name" class="w-full h-full object-cover" />
        </div>

        <!-- Details -->
        <div class="p-6">
            <h2 class="text-2xl font-bold text-surface-900 dark:text-surface-0 mb-1">
                {{ investment()!.name }}
            </h2>
            <span class="inline-block text-sm font-medium text-primary bg-primary/10 px-3 py-1 rounded-full mb-4">
                {{ investment()!.category }}
            </span>
            <p class="text-surface-600 dark:text-surface-400 mb-6 leading-relaxed">
                {{ investment()!.description }}
            </p>

            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                    <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">Equipment Cost</div>
                    <div class="font-semibold text-surface-900 dark:text-surface-0">{{ investment()!.equipmentCost | currency: 'USD' : 'symbol' : '1.0-0' }}</div>
                </div>
                <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                    <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">Annual Operating Costs</div>
                    <div class="font-semibold text-surface-900 dark:text-surface-0">{{ investment()!.otherAnnualCosts | currency: 'USD' : 'symbol' : '1.0-0' }}</div>
                </div>
                <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4"></div>
            </div>

            <!-- ROI Parameters Form -->
            <div class="pt-6">
                <div class="grid grid-cols-2 gap-x-4 gap-y-6">
                    <p-floatlabel variant="on" class="w-full">
                        <p-inputnumber [(ngModel)]="ftePositions" inputId="ftePositions" [minFractionDigits]="0" [maxFractionDigits]="2" [min]="0" class="w-full" [inputStyleClass]="'w-full'" />
                        <label for="ftePositions">FTE Positions</label>
                    </p-floatlabel>

                    <p-floatlabel variant="on" class="w-full">
                        <p-inputnumber [(ngModel)]="fullyLoadedAnnualCostPerFte" inputId="fullyLoadedAnnualCostPerFte" mode="currency" currency="USD" locale="en-US" [min]="0" class="w-full" [inputStyleClass]="'w-full'" />
                        <label for="fullyLoadedAnnualCostPerFte">Annual Cost Per FTE</label>
                    </p-floatlabel>

                    <p-floatlabel variant="on" class="w-full">
                        <p-inputnumber [(ngModel)]="timeHorizonYears" inputId="timeHorizonYears" [minFractionDigits]="0" [maxFractionDigits]="0" [min]="1" suffix=" years" class="w-full" [inputStyleClass]="'w-full'" />
                        <label for="timeHorizonYears">Time Horizon</label>
                    </p-floatlabel>

                    <div class="flex items-center">
                        <p-checkbox [(ngModel)]="includeNpv" inputId="includeNpv" [binary]="true" />
                        <label for="includeNpv" class="ml-2 text-surface-700 dark:text-surface-300">Include NPV</label>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-x-4 gap-y-6 mt-6">
                    @if (includeNpv) {
                        <p-floatlabel variant="on" class="w-full">
                            <p-inputnumber [(ngModel)]="discountRatePercent" inputId="discountRatePercent" [minFractionDigits]="0" [maxFractionDigits]="2" [min]="0" [max]="100" suffix="%" class="w-full" [inputStyleClass]="'w-full'" />
                            <label for="discountRatePercent">Discount Rate</label>
                        </p-floatlabel>
                    }
                    <div class="flex items-center" [class.col-start-2]="!includeNpv">
                        <p-button label="Calculate" severity="success" (onClick)="calculate()" styleClass="w-full" class="w-full" />
                    </div>
                </div>
            </div>

            <!-- Results -->
            @if (result) {
                <div class="pt-6 mt-6 px-6 pb-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                            <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">Effective Investment</div>
                            <div class="font-semibold text-surface-900 dark:text-surface-0">{{ formatCurrency(result.investment.effectiveInvestment) }}</div>
                        </div>
                        <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                            <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">Net Annual Benefit</div>
                            <div class="font-semibold text-surface-900 dark:text-surface-0">{{ formatCurrency(result.annual.netAnnualBenefit) }}</div>
                        </div>
                        <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                            <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">Payback</div>
                            <div class="font-semibold text-surface-900 dark:text-surface-0">
                                @if (result.payback.paybackYears !== null) {
                                    {{ formatYears(result.payback.paybackYears) }}
                                } @else {
                                    Not achievable
                                }
                            </div>
                        </div>
                        <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                            <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">ROI (Horizon)</div>
                            <div class="font-semibold text-surface-900 dark:text-surface-0">
                                @if (result.horizon.roiPercent !== null) {
                                    {{ result.horizon.roiPercent | number: '1.2-2' }}%
                                } @else {
                                    Undefined
                                }
                            </div>
                        </div>
                        @if (includeNpv && result.npv.value !== null) {
                            <div class="bg-surface-50 dark:bg-surface-800 rounded-xl p-4">
                                <div class="text-sm text-surface-500 dark:text-surface-400 mb-1">NPV</div>
                                <div class="font-semibold text-surface-900 dark:text-surface-0">{{ formatCurrency(result.npv.value!) }}</div>
                            </div>
                        }
                        <div class="col-span-3 flex items-center justify-center gap-4">
                            <p-button
                                label="Generate Internal ROI Report"
                                [outlined]="true"
                                styleClass="w-full"
                                class="flex-1"
                                [loading]="reportGenerating()"
                                [disabled]="reportGenerating()"
                                (onClick)="generateInternalRoiReport()"
                            />
                            <p-button label="Search for Grants" [outlined]="true" styleClass="w-full" class="flex-1" />
                        </div>
                        @if (reportError()) {
                            <div class="col-span-3 text-red-600 dark:text-red-400 text-sm">
                                {{ reportError() }}
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
} @else {
    <div class="flex flex-col items-center justify-center h-full text-surface-400 dark:text-surface-500">
        <span class="pi pi-search text-5xl mb-4"></span>
        <p class="text-lg">Select an investment to view details</p>
    </div>
}
